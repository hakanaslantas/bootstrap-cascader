{"version":3,"sources":["js/bootstrap-cascader.js"],"names":["$","DEF_OPTS","splitChar","btnCls","placeHolder","dropUp","lazy","openOnHover","onChange","noop","selectable","item","loaded","children","length","TPLS","enHtml","value","String","replace","DropdownPanel","data","csd","panel","this","selectItem","itemEl","params","call","setItemOpened","panelEl","removeClass","addClass","selectItemByCode","code","trigger","setSelected","setOpen","c","scrollToOpened","isMatchedSelectedItems","currItem","j","level","selectedItem","selectedItems","selectedItemCode","currItemData","originData","parent","find","size","scrollTop","top","position","height","handler","loadData","then","refreshPanels","always","appendTo","el","lastPanel","panels","lastPanelEl","lastPanelLeft","Number","css","left","outerWidth","push","each","i","itemData","itemName","name","n","itemCode","attr","text","bind","openTimeout","clearTimeout","setTimeout","destroy","remove","Cascader","def","initialized","Array","convertData2Col","isLazy","d","childMap","hasChild","updateBtnText","btn","getValue","setValue","clearValue","names","oldSelectedItems","join","updateViewBySelected","panelNo","rmPanels","splice","rmPanel","unshift","close","open","toggleClass","slice","openedItems","defered","Deferred","resolve","reject","promise","cols","insertAfter","click","e","preventDefault","stopPropagation","hasClass","cascader","target","parents","fn","bsCascader","args","arguments","$this","extend","val","split","apply","prototype","jQuery"],"mappings":"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","file":"bootstrap-cascader-0e9f086f8f.min.js","sourcesContent":["(function ($) {\n  'use strict';\n\n  // DEF_OPTS\n  var DEF_OPTS = {\n    splitChar: ' ',\n    btnCls: 'btn-default',\n    placeHolder: '请选择',\n    dropUp: false,\n    lazy: false,\n    openOnHover: false,\n    onChange: $.noop,\n    selectable: function (item) {\n      return item && item.loaded && (!item.children || item.children.length <= 0 || item.selectable);\n    }\n  };\n\n  // TPLS\n  var TPLS = {\n    containerTpl: '<div class=\"btn-group bootstrap-cascader\"></div>',\n    btnTpl: '<button class=\"btn dropdown-toggle bs-placeholder\" type=\"button\">\\\n        <span class=\"filter-option pull-left\"></span> <span class=\"caret icon-arrow-down\"></span> <span class=\"icon-cross iconfont icon-jiaochacross78\"></span>\\\n      </button>',\n    dropdownTpl: '<ul class=\"dropdown-menu\"></ul>',\n    dropdownItemTpl: '<li>\\\n        <a href=\"javascript:\">\\\n          <span class=\"text\"></span>\\\n          <span class=\"iconfont icon-ico-right-arrow item-right-arrow\"></span>\\\n          <span class=\"iconfont icon-loading item-loading\"></span>\\\n        </a>\\\n      </li>'\n  };\n\n  var enHtml = function (value) {\n    return !value ? '' : String(value).replace(/&/g, \"&amp;\").replace(/>/g, \"&gt;\").replace(/</g, \"&lt;\").replace(/\"/g, \"&quot;\");\n  };\n\n  // DropdownPanel\n  var DropdownPanel = function (data, csd) {\n    if (!data || !data.children) return;\n\n    var panel = this;\n    this.selectItem = function (item, itemEl) {\n      var selectable = csd.params.selectable.call(csd, item);\n      if (selectable) csd.selectItem(itemEl);\n    };\n\n    this.setItemOpened = function (item, itemEl) {\n      panel.panelEl.children('li').removeClass('open');\n      itemEl.addClass('open');\n      if (item.loaded && item.children.length == 0) itemEl.addClass('no-child');\n    };\n\n    this.selectItemByCode = function (code) {\n      panel.panelEl.children('li[code=' + enHtml(code) + ']').trigger('selectItem');\n    };\n\n    this.setSelected = function (item, setOpen) {\n      var itemEl = panel.panelEl.children('li[code=' + enHtml(item.code || item.c) + ']');\n      itemEl.children('a').addClass('selected');\n      if (setOpen) panel.setItemOpened(item, itemEl);\n      panel.scrollToOpened();\n    };\n\n    this.isMatchedSelectedItems = function (item) {\n      var currItem = item;\n      for (var j = item.level - 1; j >= 0; j--) {\n        var selectedItem = csd.selectedItems[j], selectedItemCode = selectedItem.code || selectedItem.c;\n        var currItemData = currItem.originData, currItemCode = currItemData.code || currItemData.c;\n        if (selectedItemCode != currItemCode) return false;\n        currItem = currItem.parent;\n      }\n      return true;\n    };\n\n    this.scrollToOpened = function () {\n      var panelEl = panel.panelEl, selectedItem = panelEl.find('li a.selected').parent();\n      if (selectedItem.size() > 0) {\n        var scrollTop = panelEl.scrollTop(), top = selectedItem.position().top + scrollTop;\n        if (scrollTop < top) {\n          top = top - (panelEl.height() - selectedItem.height()) / 2;\n          panelEl.scrollTop(top);\n        }\n      }\n    };\n\n    var handler = function (item, itemEl, selectItem) {\n      if (csd.params.lazy && item.loaded === false) {\n        itemEl.addClass('loading');\n        csd.loadData(item).then(function () {\n          csd.refreshPanels(item.level + 1, item);\n        }, function () {\n          itemEl.addClass('load-error');\n        }).always(function () {\n          panel.setItemOpened(item, itemEl);\n          itemEl.removeClass('loading');\n        });\n      } else {\n        csd.refreshPanels(item.level + 1, item);\n        panel.setItemOpened(item, itemEl);\n        if (selectItem) panel.selectItem(item, itemEl);\n      }\n    };\n\n    panel.panelEl = $(TPLS.dropdownTpl).appendTo(csd.el), panel.data = data;\n\n    // set panel position\n    var lastPanel = csd.panels[csd.panels.length - 1];\n    if (lastPanel) {\n      var lastPanelEl = lastPanel.panelEl, lastPanelLeft = Number((lastPanelEl.css('left') || '').replace('px', ''));\n      panel.panelEl.css({left: lastPanelLeft + lastPanelEl.outerWidth()})\n    }\n    csd.panels.push(panel);\n\n    // update panel style\n    if (csd.panels.length > 0) {\n      csd.el.children('.dropdown-menu').removeClass('first-child last-child');\n      csd.panels[0].panelEl.addClass('first-child');\n      csd.panels[csd.panels.length - 1].panelEl.addClass('last-child');\n    }\n\n    $.each(data.children, function (i, item) {\n      var itemEl = $(TPLS.dropdownItemTpl).appendTo(panel.panelEl), itemData = item.originData;\n      var itemName = itemData.name || itemData.n, itemCode = itemData.code || itemData.c;\n      itemEl.data(\"cascaderItem\", item).attr('code', itemCode).attr('title', itemName).find('.text').text(itemName);\n\n      itemEl.bind('selectItem click', function () {\n        handler(item, itemEl, true);\n      }).bind('openDropdown', function () {\n        handler(item, itemEl);\n      });\n\n      if (csd.params.openOnHover) {\n        itemEl.bind('mouseover', function () {\n          if (csd.openTimeout) clearTimeout(csd.openTimeout);\n          csd.openTimeout = setTimeout(function () {\n            handler(item, itemEl);\n          }, csd.params.lazy ? 200 : 100);\n        });\n      }\n\n      if (item.loaded && (!item.children || item.children.length <= 0)) itemEl.addClass('no-child');\n\n      // update selected items view state\n      if (csd.selectedItems.length >= item.level && panel.isMatchedSelectedItems(item)) {\n        if (csd.selectedItems.length > item.level) {\n          handler(item, itemEl, false);\n        } else {\n          $.each(csd.selectedItems, function (j, selectedItem) {\n            csd.panels[j].setSelected(selectedItem, j < csd.selectedItems.length - 1);\n          });\n        }\n      }\n    });\n\n    this.destroy = function () {\n      panel.panelEl.remove();\n    };\n  };\n\n  // Cascader\n  var Cascader = function (params) {\n    var csd = this;\n    params = params || {};\n    for (var def in DEF_OPTS) if (typeof params[def] === 'undefined') params[def] = DEF_OPTS[def];\n    csd.params = params, csd.initialized = false, csd.selectedItems = [];\n    if (csd.params.value instanceof Array) csd.selectedItems = [];\n\n    // initBtn\n    var initBtn = function () {\n      csd.btn = $(TPLS.btnTpl).addClass(params.btnCls).click(function () {\n        csd.open();\n      }).appendTo(csd.el);\n      csd.btn.children('.icon-cross').click(function (e) {\n        csd.clearValue();\n        e.preventDefault();\n        e.stopPropagation();\n      });\n      updateBtnText(params.placeHolder);\n    };\n\n    // convertData2Col\n    var convertData2Col = function (data, parent) {\n      var isLazy = csd.params.lazy;\n      $.each(data, function (i, item) {\n        var itemCode = item.code || item.c, children = item.data || item.d;\n        var itemData = {\n          childMap: {}, children: [], loaded: !isLazy || item.hasChild === false,\n          level: parent.level + 1, parent: parent, originData: item\n        };\n        parent.children.push(itemData);\n        parent.childMap[itemCode] = itemData;\n        if (children && children.length > 0) convertData2Col(children, itemData);\n      });\n    };\n\n    // updateBtnText\n    var updateBtnText = function (text) {\n      csd.btn.attr('title', text).children('.filter-option').text(text);\n      if (csd.getValue().length > 0) csd.btn.removeClass('bs-placeholder').addClass('selected');\n      else csd.btn.addClass('bs-placeholder').removeClass('selected');\n    };\n\n    // setValue\n    csd.setValue = function (value) {\n      csd.clearValue();\n\n      var names = [], oldSelectedItems = csd.getValue;\n      $.each(value, function (i, item) {\n        csd.selectedItems.push({code: item.code || item.c, name: item.name || item.n});\n        names.push(item.name || item.n);\n      });\n      updateBtnText(names.join(csd.params.splitChar));\n      csd.updateViewBySelected();\n      csd.params.onChange(oldSelectedItems, value);\n    };\n\n    // refreshPanels\n    csd.refreshPanels = function (panelNo, data) {\n      var rmPanels = csd.panels.splice(panelNo - 1, csd.panels.length);\n      if (rmPanels) $.each(rmPanels, function (i, rmPanel) {\n        rmPanel.destroy();\n      });\n\n      new DropdownPanel(data, csd);\n    };\n\n    // selectItem\n    csd.selectItem = function (itemEl) {\n      csd.el.find('li a').removeClass('selected');\n      itemEl.children('a').addClass('selected');\n      csd.el.find('li.open a').addClass('selected');\n\n      var item = itemEl.data('cascaderItem'), names = [], oldSelectedItems = csd.getValue();\n      csd.selectedItems = [];\n      while (item.parent) {\n        var itemData = item.originData, code = itemData.code || itemData.c, name = itemData.name || itemData.n;\n        csd.selectedItems.unshift({code: code, name: name});\n        names.unshift(name);\n        item = item.parent;\n      }\n\n      updateBtnText(names.join(csd.params.splitChar));\n      csd.close();\n\n      csd.params.onChange(oldSelectedItems, csd.getValue());\n    };\n\n    // close\n    csd.close = function () {\n      csd.el.removeClass('open');\n      csd.updateViewBySelected();\n    };\n\n    // update view by selected\n    csd.updateViewBySelected = function () {\n      if (csd.selectedItems.length > 0)\n        csd.panels[0].selectItemByCode(csd.selectedItems[0].code || csd.selectedItems[0].c);\n    };\n\n    // open\n    csd.open = function () {\n      csd.el.toggleClass('open');\n\n      $.each(csd.panels, function (i, panel) {\n        panel.scrollToOpened();\n      });\n    };\n\n    // getValue\n    csd.getValue = function () {\n      return csd.selectedItems.slice();\n    };\n\n    // clearValue\n    csd.clearValue = function () {\n      csd.selectedItems = [];\n      csd.el.find('.dropdown-menu li a').removeClass('selected');\n      updateBtnText(csd.params.placeHolder);\n    };\n\n    // loadData\n    csd.loadData = function (item) {\n      // get opened items\n      var openedItems = [];\n      if (item) {\n        var currItem = item;\n        while (currItem.parent) {\n          openedItems.unshift(currItem.originData);\n          currItem = currItem.parent;\n        }\n      } else item = csd.data;\n\n      var defered = $.Deferred();\n      csd.params.loadData.call(csd, openedItems, function (data) {\n        if (data) {\n          if (data.length > 0) {\n            if (!openedItems || openedItems.length <= 0) csd.data.originData = data;\n            convertData2Col(data, item);\n          }\n          item.loaded = true;\n          defered.resolve(data);\n        } else defered.reject();\n      });\n      return defered.promise();\n    };\n\n    csd.data = {childMap: {}, children: [], loaded: false, level: 0}, csd.panels = [];\n    csd.cols = [], csd.el = $(TPLS.containerTpl).insertAfter(params.el), params.el.remove(), params.el = csd.el;\n    initBtn();\n\n    csd.loadData().always(function () {\n      csd.refreshPanels(1, csd.data);\n      if (csd.params.value) csd.setValue(csd.params.value);\n    });\n\n    $('html').click(function (e) {\n      if (!csd.el.hasClass('open')) return;\n      var cascader = $(e.target).parents('.bootstrap-cascader');\n      if (cascader.size() == 0) csd.close();\n      else if (cascader[0] != csd.el[0]) csd.close();\n    });\n  };\n\n  $.fn.bsCascader = function (params) {\n    var args = arguments;\n    return this.each(function () {\n      if (!this) return;\n      var $this = $(this);\n\n      var bsCascader = $this.data(\"bsCascader\");\n      if (!bsCascader) {\n        params = $.extend({\n          el: $this, value: $this.val() ? $this.val().split(params.splitChar || ' ') : ''\n        }, params);\n        bsCascader = new Cascader(params);\n        $this.data(\"bsCascader\", bsCascader);\n      }\n      if (typeof params === typeof \"a\")\n        bsCascader[params].apply(bsCascader, Array.prototype.slice.call(args, 1));\n    });\n  }\n\n})(jQuery);\n"]}